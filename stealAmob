-- LocalScript in StarterPlayerScripts

--// Services
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer
local RS = game:GetService("ReplicatedStorage")

--// Variables
local savedPos = nil
local oldPos = nil
local espEnabled = false
local instantInteract = false
local forwardDistance = 10 -- default forward distance
local delayTime = 0.1 -- blink delay for steal
local espFolder = Instance.new("Folder")
espFolder.Name = "ESP_Highlights"
espFolder.Parent = game.CoreGui

--// UI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0, 250, 0, 500) -- space for all buttons
Frame.Position = UDim2.new(0.35, 0, 0.35, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Visible = true

-- Title
local Title = Instance.new("TextLabel")
Title.Parent = Frame
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Title.Text = "xlic made this (if u paid for this you got scammed)"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.BorderSizePixel = 0

-- Buttons
local function makeButton(text, yPos)
    local btn = Instance.new("TextButton")
    btn.Parent = Frame
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Text = text
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.AutoButtonColor = true
    btn.BorderSizePixel = 0
    return btn
end

local saveBtn = makeButton("Save Position", 40)
local tpBtn = makeButton("TP to Position", 80)
local backBtn = makeButton("TP Back", 120)
local forwardBtn = makeButton("TP Forward", 160)
local tpSavedBtn = makeButton("TP Last Saved", 200)

-- Forward distance box
local forwardBox = Instance.new("TextBox")
forwardBox.Parent = Frame
forwardBox.Size = UDim2.new(1, -20, 0, 30)
forwardBox.Position = UDim2.new(0, 10, 0, 240)
forwardBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
forwardBox.TextColor3 = Color3.fromRGB(255, 255, 255)
forwardBox.PlaceholderText = "Forward Distance (default 10)"
forwardBox.Font = Enum.Font.Gotham
forwardBox.TextSize = 14
forwardBox.ClearTextOnFocus = false
forwardBox.Text = ""

local espBtn = makeButton("ESP: OFF", 280)
local stealBtn = makeButton("Steal", 320)
local interactBtn = makeButton("Instant Interact: OFF", 360)
local hopBtn = makeButton("Server Hop", 400)

--// Functions
local function getChar()
    return player.Character or player.CharacterAdded:Wait()
end

saveBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        savedPos = hrp.CFrame
        warn("Position saved!")
    end
end)

tpBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp and savedPos then
        oldPos = hrp.CFrame
        hrp.CFrame = savedPos
    end
end)

-- TP Last Saved
tpSavedBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp and savedPos then
        hrp.CFrame = savedPos
    end
end)

-- TP Back
backBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp and oldPos then
        hrp.CFrame = oldPos
    end
end)

-- TP Forward
forwardBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        hrp.CFrame = hrp.CFrame * CFrame.new(0, 0, -forwardDistance)
    end
end)

forwardBox.FocusLost:Connect(function()
    local value = tonumber(forwardBox.Text)
    if value then
        forwardDistance = value
    else
        forwardDistance = 10
        forwardBox.Text = ""
    end
end)

-- ESP
local keywords = { "Secret", "Diamond", "Gold", "Rainbow", "Normal" }

local function createESP(obj)
    if not obj:IsA("Model") then return end
    local hrp = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
    if not hrp then return end

    local highlight = Instance.new("Highlight")
    highlight.Adornee = obj
    highlight.FillColor = Color3.fromRGB(0, 255, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.Parent = espFolder

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = hrp
    billboard.Size = UDim2.new(0, 100, 0, 50)
    billboard.AlwaysOnTop = true
    billboard.Parent = espFolder

    local label = Instance.new("TextLabel")
    label.Parent = billboard
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = obj.Name
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
end

local function scanForMobs()
    for _, container in pairs({RS, workspace:FindFirstChild("Mobs")}) do
        if container then
            for _, obj in pairs(container:GetDescendants()) do
                for _, word in ipairs(keywords) do
                    if string.find(obj.Name, word) then
                        createESP(obj)
                        break
                    end
                end
            end
        end
    end
end

local function toggleESP()
    espEnabled = not espEnabled
    if espEnabled then
        espBtn.Text = "ESP: ON (broke)"
        scanForMobs()
    else
        espBtn.Text = "ESP: OFF"
        espFolder:ClearAllChildren()
    end
end

espBtn.MouseButton1Click:Connect(toggleESP)

-- Steal Button (blink with 0.1s delay)
stealBtn.MouseButton1Click:Connect(function()
    local char = getChar()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp and savedPos then
        oldPos = hrp.CFrame
        hrp.CFrame = savedPos
        task.wait(0.1)
        hrp.CFrame = oldPos
    end
end)

-- Instant Interact
local function setPromptInstant(prompt, state)
    if state then
        prompt.HoldDuration = 0
    else
        prompt.HoldDuration = prompt:GetAttribute("OriginalHoldDuration") or prompt.HoldDuration
    end
end

-- Save original hold duration for all current prompts
for _, prompt in pairs(workspace:GetDescendants()) do
    if prompt:IsA("ProximityPrompt") then
        if prompt:GetAttribute("OriginalHoldDuration") == nil then
            prompt:SetAttribute("OriginalHoldDuration", prompt.HoldDuration)
        end
    end
end

-- Track new prompts
workspace.DescendantAdded:Connect(function(obj)
    if obj:IsA("ProximityPrompt") then
        if obj:GetAttribute("OriginalHoldDuration") == nil then
            obj:SetAttribute("OriginalHoldDuration", obj.HoldDuration)
        end
        if instantInteract then
            obj.HoldDuration = 0
        end
    end
end)

-- Toggle button
interactBtn.MouseButton1Click:Connect(function()
    instantInteract = not instantInteract
    interactBtn.Text = instantInteract and "Instant Interact: ON" or "Instant Interact: OFF"
end)

-- Loop to always apply when ON
task.spawn(function()
    while true do
        if instantInteract then
            for _, prompt in pairs(workspace:GetDescendants()) do
                if prompt:IsA("ProximityPrompt") then
                    prompt.HoldDuration = 0
                end
            end
        end
        task.wait(1)
    end
end)

-- Server Hop
hopBtn.MouseButton1Click:Connect(function()
    local function serverHop()
        local servers = {}
        local cursor = ""
        local currentJobId = game.JobId
        local gameId = game.PlaceId

        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(
                ("https://games.roblox.com/v1/games/%d/servers/Public?limit=100&cursor=%s"):format(gameId, cursor)
            ))
        end)

        if success and response and response.data then
            for _, server in ipairs(response.data) do
                if server.id ~= currentJobId and server.playing < server.maxPlayers then
                    table.insert(servers, server.id)
                end
            end
        end

        if #servers > 0 then
            local newServer = servers[math.random(1, #servers)]
            TeleportService:TeleportToPlaceInstance(gameId, newServer, player)
        else
            warn("No available servers found to hop into.")
        end
    end

    serverHop()
end)
